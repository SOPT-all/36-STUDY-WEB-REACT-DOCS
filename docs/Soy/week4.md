# State ì—…ë°ì´íŠ¸ í

state ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ë©´ ë‹¤ìŒ ë Œë”ë§ì´ íì— ë“¤ì–´ê°„ë‹¤.

ê·¸ëŸ¬ë‚˜ ë‹¤ìŒ ë Œë”ë§ì„ íì— ë„£ê¸° ì „ì—, ê°’ì— ëŒ€í•´ ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

```jsx
import { useState } from 'react';

export default function Counter() {
  const [number, setNumber] = useState(0);

  return (
    <>
      <h1>{number}</h1>
      <button onClick={() => {
        setNumber(number + 1);
        setNumber(number + 1);
        setNumber(number + 1);
      }}>+3</button>
    </>
  )
}

```

1. ê° ë Œë”ë§ì˜ state ê°’ì€ ê³ ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë Œë”ë§ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ number ê°’ì€ ëª‡ ë²ˆì„ í˜¸ì¶œí•˜ë“  í•­ìƒ 0
2. ReactëŠ” state ì—…ë°ì´íŠ¸ë¥¼ í•˜ê¸° ì „ì— ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ëª¨ë“  ì½”ë“œê°€ ì‹¤í–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. â†’ ë Œë”ë§ì€ ëª¨ë“  `setNumber()` í˜¸ì¶œì´ ì™„ë£Œëœ ì´í›„ì—ë§Œ ì¼ì–´ë‚¨ 

### batching

- ë„ˆë¬´ ë§ì€ ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ì§€ ì•Šê³ ë„ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‚˜ì˜¨ ë‹¤ìˆ˜ì˜ state ë³€ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.

= ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì™€ ê·¸ ì•ˆì— ìˆëŠ” ì½”ë“œê°€ ì™„ë£Œë  ë•Œê¹Œì§€ UIê°€ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•ŠëŠ”ë‹¤.

- ì•ˆì „í•œ ê²½ìš°ì—ë§Œ ìˆ˜í–‰
    - í´ë¦­ê³¼ ê°™ì€ ì˜ë„ì ì¸ ì´ë²¤íŠ¸ì— ëŒ€í•´ì„œëŠ” ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ

ğŸ‘ **ì¥ì **

- React ì•±ì˜ ë¹ ë¥¸ ì‹¤í–‰ ê°€ëŠ¥
- ì¼ë¶€ ë³€ìˆ˜ë§Œ ì—…ë°ì´íŠ¸ëœ(ë°˜ì¯¤ ì™„ì„±ëœ) í˜¼ë€ìŠ¤ëŸ¬ìš´ ë Œë”ë§ ì²˜ë¦¬ X

## **ë‹¤ìŒ ë Œë”ë§ ì „ì— ë™ì¼í•œ state ë³€ìˆ˜ë¥¼ ì—¬ëŸ¬ ë²ˆ ì—…ë°ì´íŠ¸í•˜ê¸°**

> **ì—…ë°ì´í„° í•¨ìˆ˜(updater function)**
`setNumber(n => n + 1)` ì™€ ê°™ì´ ì´ì „ íì˜ stateë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ stateë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì „ë‹¬
> 

â†’ state ê°’ì„ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ Reactì—ê²Œ â€œstate ê°’ìœ¼ë¡œ ë¬´ì–¸ê°€ë¥¼ í•˜ë¼â€ê³  ì§€ì‹œ

1. ReactëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ë‹¤ë¥¸ ì½”ë“œê°€ ëª¨ë‘ ì‹¤í–‰ëœ í›„ì— ì´ í•¨ìˆ˜ê°€ ì²˜ë¦¬ë˜ë„ë¡ íì— ë„£ìŒ
2. ë‹¤ìŒ ë Œë”ë§ ì¤‘ì— ReactëŠ” íë¥¼ ìˆœíšŒí•˜ì—¬ ìµœì¢… ì—…ë°ì´íŠ¸ëœ stateë¥¼ ì œê³µ

```jsx
<button onClick={() => {
  setNumber(number + 5);
  setNumber(n => n + 1);
  setNumber(42);
}}>
```

| queued update | `n` | returns |
| --- | --- | --- |
| â€replace withÂ `5`â€ | `0`Â (unused) | `5` |
| `n => n + 1` | `5` | `5 + 1 = 6` |
| â€replace withÂ `42`â€ | `6`Â (unused) | `42` |
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì™„ë£Œë˜ë©´ ë¦¬ë Œë” ì‹¤í–‰, ê·¸ë™ì•ˆ í ì²˜ë¦¬
- ì—…ë°ì´í„° í•¨ìˆ˜ëŠ” ë Œë”ë§ ì¤‘ì— ì‹¤í–‰ë˜ë¯€ë¡œ, **ìˆœìˆ˜í•´ì•¼ í•˜ë©°** ê²°ê³¼ë§Œ ë°˜í™˜í•´ì•¼ í•¨

## **ëª…ëª… ê·œì¹™**

- ì—…ë°ì´í„° í•¨ìˆ˜ ì¸ìˆ˜ì˜ ì´ë¦„ì€ í•´ë‹¹ state ë³€ìˆ˜ì˜ ì²« ê¸€ìë¡œ ì§€ì •í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì 
- ìì„¸í•œ ì½”ë“œë¥¼ ì„ í˜¸í•˜ë©´ ì „ì²´ state ë³€ìˆ˜ ì´ë¦„ ë°˜ë³µ or ê°™ì€ ì ‘ë‘ì‚¬ ì‚¬ìš©

# ê°ì²´ State ì—…ë°ì´íŠ¸ í•˜ê¸°

StateëŠ” ê°ì²´ë¥¼ í¬í•¨í•œ ëª¨ë“  ì¢…ë¥˜ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆì§€ë§Œ, stateê°€ ê°€ì§„ ê°ì²´ë¥¼ ì§ì ‘ ë³€ê²½í•˜ë©´ ì•ˆë¨

â†’ ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í•˜ê³  ì‹¶ë‹¤ë©´, ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•´ stateê°€ ë³µì‚¬ë³¸ì„ ì‚¬ìš©í•˜ë„ë¡ í•´ì•¼ í•¨.

> ë³€ê²½(mutation): ê¸°ìˆ ì ìœ¼ë¡œ ê°ì²´ ìì²´ì˜ ë‚´ìš©ì„ ë°”ê¾¸ëŠ” ê²ƒ
> 

```jsx
const [position, setPosition] = useState({ x: 0, y: 0 });
```

- í•˜ì§€ë§Œ ê°ì²´ë¥¼ ë¶ˆë³€ì„±ì„ ê°€ì§„ ê²ƒì²˜ëŸ¼ ëŒ€í•˜ê³ , ë³€ê²½í•˜ëŠ” ëŒ€ì‹  êµì²´í•´ì•¼ í•¨.

## **Stateë¥¼ ì½ê¸° ì „ìš©ì¸ ê²ƒì²˜ëŸ¼ ë‹¤ë£¨ì„¸ìš”**

```jsx
onPointerMove={e => {
  position.x = e.clientX;
  position.y = e.clientY;
}}
```

positionì— í• ë‹¹ëœ ê°ì²´ë¥¼ ì´ì „ ë Œë”ë§ì—ì„œ ìˆ˜ì •í•˜ê³  ìˆì§€ë§Œ, ReactëŠ” state ì„¤ì • í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ê°ì²´ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤. ì¦‰, ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ

â†’ ë¦¬ë Œë”ë§ì„ ë°œìƒì‹œí‚¤ë ¤ë©´? ìƒˆ ê°ì²´ë¥¼ ìƒì„±í•´ state í•¨ìˆ˜ë¡œ ì „ë‹¬í•˜ê¸°

```jsx
onPointerMove={e => {
  setPosition({
    x: e.clientX,
    y: e.clientY
  });
}}
```

## **ì „ê°œ ë¬¸ë²•ìœ¼ë¡œ ê°ì²´ ë³µì‚¬í•˜ê¸°**

- ìƒˆë¡œ ìƒì„±í•˜ëŠ” ê°ì²´ì— *ì¡´ì¬í•˜ëŠ”* ë°ì´í„°ë¥¼ í¬í•¨í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
    
    ex) í•œ ê°œì˜ í•„ë“œë§Œ ìˆ˜ì •í•˜ê³ , ë‚˜ë¨¸ì§€ í•„ë“œëŠ” ì´ì „ ê°’ì„ ìœ ì§€í•˜ê³  ì‹¶ì„ ë•Œ
    

```jsx
setPerson({
  ...person, // ì´ì „ í•„ë“œë¥¼ ë³µì‚¬
  firstName: e.target.value // ìƒˆë¡œìš´ ë¶€ë¶„ì€ ë®ì–´ì“°ê¸°
});
```

âš ï¸ í•œ ë ˆë²¨ ê¹Šì´ì˜ ë‚´ìš©ë§Œ ë³µì‚¬

## **ì¤‘ì²©ëœ ê°ì²´ ê°±ì‹ í•˜ê¸°**

```jsx
const [person, setPerson] = useState({
  name: 'Niki de Saint Phalle',
  artwork: {
    title: 'Blue Nana',
    city: 'Hamburg',
    image: 'https://i.imgur.com/Sd1AgUOm.jpg',
  }
});
```

ë‹¤ìŒê³¼ ê°™ì€ ì¤‘ì²© ê°ì²´ êµ¬ì¡°ì—ì„œ `city`ë¥¼ ë°”ê¾¸ê¸° ìœ„í•´ì„œëŠ” ë¨¼ì € (ì´ì „ ê°ì²´ì˜ ë°ì´í„°ë¡œ ìƒì„±ëœ) ìƒˆë¡œìš´ `artwork` ê°ì²´ë¥¼ ìƒì„±í•œ ë’¤, ê·¸ê²ƒì„ ê°€ë¦¬í‚¤ëŠ” ìƒˆë¡œìš´ `person` ê°ì²´ë¥¼ ë§Œë“¤ì–´ì•¼ í•¨.

```jsx
const nextArtwork = { ...person.artwork, city: 'New Delhi' };
const nextPerson = { ...person, artwork: nextArtwork };
setPerson(nextPerson);

// ë˜ëŠ” ë‹¨ìˆœ í•¨ìˆ˜ í˜¸ì¶œ
setPerson({
  ...person, // ë‹¤ë¥¸ í•„ë“œ ë³µì‚¬
  artwork: { // artwork êµì²´
    ...person.artwork, // ë™ì¼í•œ ê°’ ì‚¬ìš©
    city: 'New Delhi' // í•˜ì§€ë§Œ New Delhi!
  }
});
```

## **Immerë¡œ ê°„ê²°í•œ ê°±ì‹  ë¡œì§ ì‘ì„±í•˜ê¸°**

> Immer: í¸ë¦¬í•˜ê³ , ë³€ê²½ êµ¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©° ë³µì‚¬ë³¸ ìƒì„±ì„ ë„ì™€ì£¼ëŠ”ë¼ì´ë¸ŒëŸ¬ë¦¬
> 
- ì´ì „ stateë¥¼ ë®ì–´ì“°ì§€ ì•ŠìŒ
- state ì¤‘ì²©ì´ ê¹Šì„ ë•Œ â†’ ë°˜ë³µì ì¸ ë³µì‚¬ ì½”ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŒ
- state êµ¬ì¡°ë¥¼ ë°”ê¾¸ê³  ì‹¶ì§€ ì•Šì„ ë•Œ

**ì‚¬ìš©ë°©ë²•**

1. `package.json`ì—Â `dependencies`ë¡œÂ `use-immer`ë¥¼ ì¶”ê°€
2. `npm install`ì„ ì‹¤í–‰
3. `import { useState } from 'react'`ë¥¼Â `import { useImmer } from 'use-immer'`ë¡œ êµì²´

```jsx
const [person, updatePerson] = useImmer({
    name: 'Niki de Saint Phalle',
    artwork: {
      title: 'Blue Nana',
      city: 'Hamburg',
      image: 'https://i.imgur.com/Sd1AgUOm.jpg',
    }
  });
  
   function handleCityChange(e) {
    updatePerson(draft => {
      draft.artwork.city = e.target.value;
    });
  }
```

# ë°°ì—´ State ì—…ë°ì´íŠ¸ í•˜ê¸°

- ë°°ì—´ì€ JavaScriptì—ì„œëŠ” ë³€ê²½ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, stateë¡œ ì €ì¥í•  ë•Œì—ëŠ” ë³€ê²½í•  ìˆ˜ ì—†ë„ë¡ ì²˜ë¦¬
- ê°ì²´ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, stateì— ì €ì¥ëœ ë°°ì—´ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì‹¶ì„ ë•Œì—ëŠ”, ìƒˆ ë°°ì—´ì„ ìƒì„±(í˜¹ì€ ê¸°ì¡´ ë°°ì—´ì˜ ë³µì‚¬ë³¸ì„ ìƒì„±)í•œ ë’¤, ì´ ìƒˆ ë°°ì—´ì„ stateë¡œ ë‘ì–´ ì—…ë°ì´íŠ¸
- ì½ê¸° ì „ìš©ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨.
    - `arr[0] = 'bird'`ì²˜ëŸ¼ ë°°ì—´ ë‚´ë¶€ì˜ í•­ëª©ì„ ì¬í• ë‹¹ X
    - `push()`ë‚˜ `pop()`ê°™ì€ í•¨ìˆ˜ë¡œ ë°°ì—´ì„ ë³€ê²½ X

|  | ë¹„ì„ í˜¸ (ë°°ì—´ì„ ë³€ê²½) | ì„ í˜¸ (ìƒˆ ë°°ì—´ì„ ë°˜í™˜) |
| --- | --- | --- |
| ì¶”ê°€ | `push`,Â `unshift` | `concat`,Â `[...arr]`Â ì „ê°œ ì—°ì‚°ì |
| ì œê±° | `pop`,Â `shift`,Â `splice` | `filter`,Â `slice` |
| êµì²´ | `splice`,Â `arr[i] = ...`Â í• ë‹¹ | `map` |
| ì •ë ¬ | `reverse`,Â `sort` | ë°°ì—´ì„ ë³µì‚¬í•œ ì´í›„ ì²˜ë¦¬ |

## **ë°°ì—´ì—ì„œ í•­ëª© ì œê±°í•˜ê¸°**

> `filter` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ í•„í„°ë§ í•˜ê¸°
> 

```jsx
// artist.idì™€ IDê°€ ë‹¤ë¥¸ artistsë¡œ êµ¬ì„±ëœ ë°°ì—´ì„ ìƒì„±
setArtists(
	  artists.filter(a =>
    a.id !== artist.id
  )
```

- í•´ë‹¹ artistë¥¼ ë°°ì—´ì—ì„œ í•„í„°ë§í•œ ë‹¤ìŒ, ë°˜í™˜ëœ ë°°ì—´ë¡œ ë¦¬ë Œë”ë§ì„ ìš”ì²­
- ì›ë³¸ ë°°ì—´ì€ ìˆ˜ì •ë˜ì§€ ì•ŠìŒ

## **ë°°ì—´ ë³€í™˜í•˜ê¸°**

> ë°°ì—´ì˜ ì¼ë¶€ ë˜ëŠ” ì „ì²´ í•­ëª©ì„ ë³€ê²½í•˜ê³ ì í•œë‹¤ë©´ `map` í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ìƒˆë¡œìš´ ë°°ì—´ ìƒì„±
> 

## **ë°°ì—´ ë‚´ í•­ëª© êµì²´í•˜ê¸°**

> í•­ëª©ì„ êµì²´í•˜ê¸° ìœ„í•´ `map`ì„ ì´ìš©í•´ì„œ ìƒˆë¡œìš´ ë°°ì—´ ìƒì„±
> 
- `map`ì„ í˜¸ì¶œí•  ë•Œ ë‘ ë²ˆì§¸ ì¸ìˆ˜ë¡œ í•­ëª©ì˜ ì¸ë±ìŠ¤ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
    - ì¸ë±ìŠ¤ëŠ” ì›ë˜ í•­ëª©(ì²« ë²ˆì§¸ ì¸ìˆ˜)ì„ ë°˜í™˜í• ì§€ ë‹¤ë¥¸ í•­ëª©ì„ ë°˜í™˜í• ì§€ë¥¼ ê²°ì •í•  ë•Œ ì‚¬ìš©

## **ë°°ì—´ì— í•­ëª© ì‚½ì…í•˜ê¸°**

> `â€¦ì—°ì‚°ì`, `slice()` ì›í•˜ëŠ” ìœ„ì¹˜ì— í•­ëª©ì„ ì‚½ì…í•˜ê³  ì‹¶ì„ ë•Œ
> 
- `slice()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ë°°ì—´ì˜ â€œì¼ë¶€ë¶„â€ì„ ì˜ë¼ë‚¼ ìˆ˜ ìˆìŒ
    - í•­ëª© ì‚½ì…: ì‚½ì… ì§€ì  ì•ì— ìë¥¸ ë°°ì—´ ì „ê°œ í›„ ìƒˆ í•­ëª©ê³¼ ì›ë³¸ ë°°ì—´ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì„ ì „ê°œí•˜ëŠ” ë°°ì—´ì„ ë§Œë“¦

```jsx
    const nextArtists = [
      // ì‚½ì… ì§€ì  ì´ì „ í•­ëª©
      ...artists.slice(0, insertAt),
      // ìƒˆ í•­ëª©
      { id: nextId++, name: name },
      // ì‚½ì… ì§€ì  ì´í›„ í•­ëª©
      ...artists.slice(insertAt)
    ];
```

## **ë°°ì—´ì— ê¸°íƒ€ ë³€ê²½ ì ìš©í•˜ê¸°**

Reactì—ì„œ ë°°ì—´ì„ ë’¤ì§‘ê±°ë‚˜ ì •ë ¬í•˜ëŠ” ë“±,Â ì›ë³¸ ë°°ì—´ì„ ì§ì ‘ ë³€ê²½í•˜ëŠ” reverse(), sort() ê°™ì€ í•¨ìˆ˜ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ìŒ.

ëŒ€ì‹ Â **ë°°ì—´ì„ ë³µì‚¬í•œ ë’¤ ë³µì‚¬ë³¸ì— ë³€ê²½**ì„ ì ìš©í•´ì•¼ í•¨.

```jsx
const nextList = [...list];
nextList.reverse();
setList(nextList);
```

ë‹¨, ì–•ì€ ë³µì‚¬ì˜ ê²½ìš° ê°ì²´ë“¤ì€ ì—¬ì „íˆ ì›ë³¸ê³¼ ê°™ì€ ì°¸ì¡°ë¥¼ ê°€ì§

(ë³µì‚¬ë³¸ ê°ì²´ ì§ì ‘ ìˆ˜ì • ì‹œ, ì›ë³¸ë„ ê°™ì´ ë°”ë€œ)

ë”°ë¼ì„œ, ê°ì²´ ì†ì„± ë³€ê²½ ì‹œ **ê¹Šì€ ë³µì‚¬** í•„ìš”

- ë°°ì—´ ì•ˆì˜ ê°ì²´ë¥¼ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•ŒëŠ” map()ì„ ì‚¬ìš©í•´ ë³€ê²½ì´ í•„ìš”í•œ ê°ì²´ë§Œ ìƒˆ ê°ì²´ë¡œ ë§Œë“¤ì–´ ë°˜í™˜

```jsx
setList(list.map(item =>
  item.id === targetId ? { ...item, seen: true } : item
));
```

**Immer ì‚¬ìš© ì‹œ**

Immer ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ë©´ draft ê°ì²´ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ëŠ” ë¬¸ë²•ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ë¶ˆë³€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŒ

```jsx
updateList(draft => {
  const item = draft.find(a => a.id === targetId);
  item.seen = true;
});
```